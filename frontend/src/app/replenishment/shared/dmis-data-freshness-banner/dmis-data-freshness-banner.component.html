@if (shouldRender) {
  <div
    class="freshness-banner"
    [ngClass]="{
      'banner-critical': isCritical,
      'banner-warning': isWarning,
      'banner-fresh': isFresh
    }"
    role="status"
    [attr.aria-label]="getAriaMessage()">

    <!-- Refresh progress bar -->
    @if (isRefreshing) {
      <mat-progress-bar
        mode="indeterminate"
        class="refresh-progress">
      </mat-progress-bar>
    }

    <!-- Main banner row â€” compact summary -->
    <div class="banner-main">
      <button
        class="banner-toggle"
        (click)="toggleExpanded()"
        [attr.aria-expanded]="isExpanded"
        aria-controls="freshnessDetailsPanel">
        <mat-icon class="banner-icon">{{ getBannerIcon() }}</mat-icon>
        <span class="banner-message">{{ getBannerMessage() }}</span>
        @if (!isFresh) {
          <span class="stale-count-badge" aria-hidden="true">{{ staleCount }}</span>
        }
        <mat-icon class="chevron-icon">{{ isExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
      </button>

      <div class="banner-actions">
        @if (bannerState?.lastSuccessfulSync) {
          <span class="last-sync">
            <mat-icon class="sync-icon" aria-hidden="true">schedule</mat-icon>
            {{ bannerState!.lastSuccessfulSync! | date:'shortTime' }}
          </span>
        }
        <button
          mat-stroked-button
          class="refresh-btn"
          (click)="refreshData()"
          [disabled]="isRefreshing"
          matTooltip="Trigger a fresh data sync from all warehouses">
          <mat-icon>refresh</mat-icon>
          Refresh
        </button>
      </div>
    </div>

    <!-- Expanded per-warehouse detail -->
    @if (isExpanded) {
      <div class="banner-detail" id="freshnessDetailsPanel" role="region" aria-label="Warehouse data freshness details">
        <ul class="freshness-list">
          @for (wh of bannerState?.warehouses; track wh.warehouse_id) {
            <li class="freshness-item" [ngClass]="'item-freshness-' + (wh.freshness || '').toLowerCase()">
              <div class="item-left">
                <span class="status-dot" [ngClass]="'dot-' + (wh.freshness || '').toLowerCase()" aria-hidden="true"></span>
                <span class="item-name">{{ wh.warehouse_name }}</span>
              </div>
              <div class="item-right">
                <span class="item-age">{{ formatAgeHours(wh.age_hours) }}</span>
                <span class="item-badge" [ngClass]="'badge-' + (wh.freshness || '').toLowerCase()">
                  {{ wh.freshness }}
                </span>
              </div>
            </li>
          }
        </ul>
      </div>
    }
  </div>
}
