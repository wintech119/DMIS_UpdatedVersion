create table agency
(
              agency_id integer not null generated by default as identity
                             constraint pk_agency primary key,
              
              --TRN to ensure agency's authenticity and uniqueness. Verify if TRN capture is allowed.
              --trn_nbr integer not null
              --            constraint c_agency_1 check (trn_nbr between 19 and 99999999),
              
              agency_name varchar(120) not null
                             --Agency name must be uppercase and unique
                             constraint c_agency_2 check (agency_name = upper(agency_name))
                             constraint uk_agency_1 unique,
              
              --Type of agency (distributor/shelter)
              agency_type varchar(16) not null
                             constraint c_agency_3 check (agency_type in ('DISTRIBUTOR','SHELTER')),

              address1_text varchar(255) not null,
              address2_text varchar(255),
              --Indicate parish in which agency is located
              parish_code char(2) not null
                             constraint fk_agency_parish references parish,
              
              contact_name varchar(50) not null
                             --Contact name must be in upper case.
                             constraint c_agency_4 check (contact_name = upper(contact_name)),
              phone_no varchar(20) not null,
              email_text varchar(100),

              --For what event is this agency ineligible?
              ineligible_event_id integer
                             constraint fk_agency_event references event,

              --Warehouse operated by agency. The relationship between an agency and a
              --warehouse is: [0,1]:[0,1]. Every agency (not a shelter) has a warehouse
              --but not all warehouses are operated by an agency. Hence, the warehouse
              --identifier is placed on the agency table.

              warehouse_id integer
                             constraint c_agency_5
                             check ((agency_type = 'SHELTER' and warehouse_id is null)
                                           or (agency_type != 'SHELTER' and warehouse_id is not null))
                             constraint fk_agency_warehouse references warehouse,

              status_code char(1) not null
                             --A=Active, I=Inactive
                             constraint c_agency_6 check (status_code in ('A','I')),
              
              create_by_id varchar(20) not null,
              create_dtime timestamp(0) without time zone not null,
              update_by_id varchar(20) not null,
              update_dtime timestamp(0) without time zone not null,
              version_nbr integer not null
);
--Index for selecting based on agency_name or part thereof
create index dk_agency_1 on agency(agency_name);

--Index to retrieve agencies based on parish.
create index dk_agency_1 on agency(parish_code);
